<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>k8s | 个人站点</title>
    <meta name="description" content="">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/goistio.book/assets/css/0.styles.1c9099ac.css" as="style"><link rel="preload" href="/goistio.book/assets/js/app.c80f4f4d.js" as="script"><link rel="preload" href="/goistio.book/assets/js/2.00693aab.js" as="script"><link rel="preload" href="/goistio.book/assets/js/13.e0915440.js" as="script"><link rel="prefetch" href="/goistio.book/assets/js/10.d65de9ee.js"><link rel="prefetch" href="/goistio.book/assets/js/11.cd390daf.js"><link rel="prefetch" href="/goistio.book/assets/js/12.d37dfcd2.js"><link rel="prefetch" href="/goistio.book/assets/js/14.d2d496fc.js"><link rel="prefetch" href="/goistio.book/assets/js/15.3da8ec74.js"><link rel="prefetch" href="/goistio.book/assets/js/16.6e583aed.js"><link rel="prefetch" href="/goistio.book/assets/js/17.6b02654b.js"><link rel="prefetch" href="/goistio.book/assets/js/18.dd74adb6.js"><link rel="prefetch" href="/goistio.book/assets/js/19.dfd4feed.js"><link rel="prefetch" href="/goistio.book/assets/js/3.9236af90.js"><link rel="prefetch" href="/goistio.book/assets/js/4.0f091beb.js"><link rel="prefetch" href="/goistio.book/assets/js/5.b7f21dd7.js"><link rel="prefetch" href="/goistio.book/assets/js/6.02510c18.js"><link rel="prefetch" href="/goistio.book/assets/js/7.7857b5b1.js"><link rel="prefetch" href="/goistio.book/assets/js/8.be2063e7.js"><link rel="prefetch" href="/goistio.book/assets/js/9.c66fdafb.js">
    <link rel="stylesheet" href="/goistio.book/assets/css/0.styles.1c9099ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/goistio.book/" class="home-link router-link-active"><!----> <span class="site-name">个人站点</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/goistio.book/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://cn100800.tk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="mailto:freecracy1024@gmail.com" class="nav-link external">
  mail
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://google.com.hk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  google
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/goistio.book/" class="nav-link">首页</a></div><div class="nav-item"><a href="https://cn100800.tk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="mailto:freecracy1024@gmail.com" class="nav-link external">
  mail
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://google.com.hk" target="_blank" rel="noopener noreferrer" class="nav-link external">
  google
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/goistio.book/" class="sidebar-link">go学习笔记</a></li><li><a href="/goistio.book/ip转int.html" class="sidebar-link">ip转int</a></li><li><a href="/goistio.book/排序算法.html" class="sidebar-link">排序算法</a></li><li><a href="/goistio.book/环境搭建.html" class="sidebar-link">环境搭建</a></li><li><a href="/goistio.book/设计模式.html" class="sidebar-link">设计模式</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Istio</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/goistio.book/istio/interface.html" class="sidebar-link">空接口</a></li><li><a href="/goistio.book/istio/代码二三事.html" class="sidebar-link">避坑指南</a></li><li><a href="/goistio.book/istio/内存分配2.html" class="sidebar-link">内存分配2</a></li><li><a href="/goistio.book/istio/内存模型.html" class="sidebar-link">channel</a></li><li><a href="/goistio.book/istio/学习笔记.html" class="sidebar-link">istio</a></li><li><a href="/goistio.book/istio/最小镜像.html" class="sidebar-link">创建最小go镜像</a></li><li><a href="/goistio.book/istio/环境搭建.html" class="active sidebar-link">k8s</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#minikube" class="sidebar-link">minikube</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#k8s-2" class="sidebar-link">k8s</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#kubectl" class="sidebar-link">kubectl</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#简历" class="sidebar-link">简历</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#hello-world" class="sidebar-link">hello world</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#apiserver四层" class="sidebar-link">apiserver四层</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#服务部署流程" class="sidebar-link">服务部署流程</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#list-watch机制保持数据同步" class="sidebar-link">list-watch机制保持数据同步</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#crd-operator" class="sidebar-link">CRD Operator</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#k8s-all-in-one-的yaml文件" class="sidebar-link">k8s all in one 的yaml文件</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#flutter构建mac-app" class="sidebar-link">flutter构建mac app</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#minikube代理" class="sidebar-link">minikube代理</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#部署" class="sidebar-link">部署</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#istio" class="sidebar-link">istio</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#代理启动" class="sidebar-link">代理启动</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#复制控制器" class="sidebar-link">复制控制器</a></li><li class="sidebar-sub-header"><a href="/goistio.book/istio/环境搭建.html#命令速查" class="sidebar-link">命令速查</a></li></ul></li><li><a href="/goistio.book/istio/简介.html" class="sidebar-link">istio简介</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Package</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="k8s"><a href="#k8s" class="header-anchor">#</a> k8s</h1> <h2 id="minikube"><a href="#minikube" class="header-anchor">#</a> minikube</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>brew <span class="token function">install</span> minikube <span class="token comment"># 一个可以在本地跑起来的 Kubernetes 环境,minikube需要docker作为底层支 持</span>
brew <span class="token function">install</span> kubectl <span class="token comment"># Kubernetes 的命令行客户端</span>
brew <span class="token function">install</span> docker-machine-driver-hyperkit <span class="token comment"># 给 Minikube 使用的虚拟化引擎</span>

minikube start <span class="token comment"># 创建虚拟集群</span>
minikube <span class="token function">ssh</span> <span class="token comment"># 进入集群内部</span>
minikube dashboard <span class="token comment"># 启动控制台,浏览器访问</span>
minikube docker- <span class="token function">env</span> <span class="token comment"># 查看环境变量</span>
minikube <span class="token function">ip</span> <span class="token comment"># 获取集群ip,export no_proxy=$no_proxy,$(minikube ip)</span>
</code></pre></div><h2 id="k8s-2"><a href="#k8s-2" class="header-anchor">#</a> k8s</h2> <p>用户可以通过 UI 或者 CLI 提交一个 Pod 给 Kubernetes 进行部署，这个 Pod 请求首先会通过 CLI 或者 UI 提交给 Kubernetes API Server，下一步 API Server 会把这个信息写入到它的存储系统 etcd，之后 Scheduler 会通过 API Server 的 watch 或者叫做 notification 机制得到这个信息：有一个 Pod 需要被调度。</p> <p>这个时候 Scheduler 会根据它的内存状态进行一次调度决策，在完成这次调度之后，它会向 API Server report 说：“OK！这个 Pod 需要被调度到某一个节点上。”</p> <p>这个时候 API Server 接收到这次操作之后，会把这次的结果再次写到 etcd 中，然后 API Server 会通知相应的节点进行这次 Pod 真正的执行启动。相应节点的 kubelet 会得到这个通知，kubelet 就会去调 Container runtime 来真正去启动配置这个容器和这个容器的运行环境，去调度 Storage Plugin 来去配置存储，network Plugin 去配置网络。</p> <p>两层路由 ingress(外部)、service(内部) service连接pod</p> <p><img src="https://static001.infoq.cn/resource/image/5c/f8/5c9fe50067821e9e86a74cae4cbdd9f8.png" alt="img"></p> <p>master模块</p> <p>node模块</p> <p>kubelet主要负责接收master命令维护容器生命周期,</p> <p>kube-proxy负责负载均衡,处理流量转发</p> <p>container runtime负责镜像管理以及pod和容器的真正运行.</p> <p>kube-proxy:负责方向代理和负载均衡的实现.真正落实了server,核心功能就是将service的请求转发到后端的多个pod上</p> <p>用户通过kubectl接口向k8s下发指令,指令通过.yaml的配置文件编写</p> <p>Kubernetes 是通过 Controller，也就是我们刚才提到的控制器去维护 Deployment 中 Pod 的数目，它也会去帮助 Deployment 自动恢复失败的 Pod。</p> <p>scheduler:将调度的pod绑定到node上,并将绑定信息写到etcd</p> <p>schedule负责决定pod放在哪个node上,然后将决策告诉kubelet,kubelet完成pod在node的加载工作</p> <p>当一个pod要访问其他pod时候通过service的cluster ip 和port,cluster ip和port时k8s集群的内部地址,提供给集群内其他pod之间访问使用,外部无法通过这个cluster-ip来访问k8s中的应用</p> <p>controller manager:管理系统,包括8个controller分贝对应副本,节点,资源,命名空间,服务等.</p> <p>我们把master上提供管理接口的组件称为kubeapiserver,对应还需要用于和api server交互的客户端,一个提供给集群运维管理员使用称为kubectl,一个提供给worker节点使用,称为kubelet,通过worker上的kubelet周期性的上报节点资源和容器运行情况,然后master把这个数据存储下来.</p> <p><img src="https://static001.infoq.cn/resource/image/e9/49/e95c765b7ac2b6802b165e03acd40849.png" alt="img"></p> <p>Pod、Deployment、Service 都属于一个 Namespace，同一个 Namespace 中的资源需要命名的唯一性，不同的 Namespace 中的资源可以重名。</p> <p>Kubernetes API 是由 **HTTP+JSON ** 组成的：用户访问的方式是 HTTP，访问的 API 中 content 的内容是 JSON 格式的。</p> <p>对于这个 Pod 类型的资源，它的 HTTP 访问的路径，就是 API，然后是 apiVesion: V1, 之后是相应的 Namespaces，以及 Pods 资源，最终是 Podname，也就是 Pod 的名字</p> <p>一组 Pod 就是通过 label selector 来表达的</p> <p>kubelet:通过cadvisor获取其所在node及容器(docker)的数据,cadvisor自动采集cpu,内存,文件,网络,使用统计信息,kubelet作为node的管理者,把cadvisor采集上来的数据通过restapi的形式暴露给k8s其他资源</p> <p>每次kubectl发送来的指令都会被apiserver先存储到etcd中</p> <p>controller manager监控容器情况,通过监听apiserver里面提供的一个list watch接口来监控哥哥集群资源数据,调整集群资源状态</p> <p>scheduler主要是调度作用,将容器部署到指定机器上,然后将pod和node字眼映射,决定每个pod放在哪个node上,命令kubelet惊醒容器部署.</p> <h2 id="kubectl"><a href="#kubectl" class="header-anchor">#</a> kubectl</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>kubectl create -f pod.yml <span class="token comment"># 创建pod 这里可以 --record=true 让 Kubernetes 把这行命令记到发布历史中备查。这 时可以⻢上运行下面的命令查看各个 pod 的状态:</span>
kubectl create -f svc.yml	<span class="token comment"># 创建服务,可供外部访问,服务对外</span>
kubectl create -f deployment.yml <span class="token comment"># 创建deployment,服务对内,多pod节点</span>
kubectl get nodes
kubectl get deployments
kubectl apply -f 
kubectl describe pods <span class="token operator">|</span> <span class="token function">grep</span> Labels
kubectl describe services
kubectl delete pod k8s-
kubectl rollout status deployment k8s-demo-deployment <span class="token comment"># 查看发布状态</span>
kubectl rollout undo deployment k8s-demo-deployment --to-revision<span class="token operator">=</span><span class="token number">1</span> <span class="token comment"># 回滚到上个版本</span>
kubectl run helloworld --image<span class="token operator">=</span>registry.cn-qingdao.aliyuncs.com/gold-faa <span class="token comment"># 通过镜像创建一个deployment</span>
kubectl proxy <span class="token comment"># 创建一个当前终端到k8s cluster的代理,使用proxy来访问内部容器的方法更多适合在debug等场景下使用，当我 们需要对外提供可用的真实服务时，需要更加可靠的手段，那就是 Service </span>
kubectl expose <span class="token comment"># 创建service服务</span>
kubectl get <span class="token function">service</span> <span class="token comment"># 查询已创建服务 -l 类sql过滤</span>
kubectl label <span class="token comment"># 自定义label</span>
kubectl delete <span class="token function">service</span> name <span class="token comment"># 删除服务</span>
</code></pre></div><p>Deployment 是在 Pod 这个抽象上更为上层的一个抽象，它可以定义一组 Pod 的副本数目、以及这个 Pod 的版本。一般大家用 Deployment 这个抽象来做应用的真正的管理，而 Pod 是组成 Deployment 最小的单元。</p> <p>Node节点包括Docker、kubelet、kube-proxy、Fluentd、kube-dns</p> <p>Kubelet，主要负责监视指派到它所在Node上的Pod，包括创建、修改、监控、删除等。</p> <p>Kube-proxy，主要负责为Pod对象提供代理。</p> <p>Fluentd，主要负责日志收集、存储与查询。</p> <p>Minikube 启动时会自动配置 kubectl，把它指向 Minikube 提供的 Kubernetes API 服务。可以用下面的命令确认</p> <div class="language-sh extra-class"><pre class="language-sh"><code>kubectl config current-context <span class="token comment"># </span>
</code></pre></div><p>通常一 个 pod 中只有一个容器</p> <p>Minikube 自带了 Docker 引擎，所以我们需要重新配置客户端，让 docker 命 令行与 Minikube 中的 Docker 进程通讯</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span>minikube docker-env<span class="token variable">)</span></span>
</code></pre></div><p>Kubernetes 的用户通常是用 Deployment 来管理服务的。一个 deployment 可以创建指定数量的 pod 部署到各个 node 上，并可完成更新、回滚等操 作。</p> <p>这是k8s区别于其他容器编排平台的一个显著特点:它不直接运行容器，而是 运行一种称为Pod的高级结构，里面封装了一系列相关的容器，并共享相同 的namespace和网络。</p> <p>node作为物理节点,需要使用node-ip和node-port组合来从k8s外面访问内部应用</p> <h2 id="简历"><a href="#简历" class="header-anchor">#</a> 简历</h2> <p>可以在本地的 Kubernetes 环境测试自己的前后端项目</p> <h2 id="hello-world"><a href="#hello-world" class="header-anchor">#</a> hello world</h2> <h2 id="apiserver四层"><a href="#apiserver四层" class="header-anchor">#</a> apiserver四层</h2> <ol><li>api层,主要以rest方式提供api接口,crud,watch,健康检查,日志,性能指标等</li> <li>访问控制层,负责身份健全,核准用户对资源的访问权限,设置访问逻辑</li> <li>注册表层,选择访问的资源对象,k8s把所有资源对象保存在注册表中</li> <li>etcd数据库:用来持久化k8s的资源对象</li></ol> <h2 id="服务部署流程"><a href="#服务部署流程" class="header-anchor">#</a> 服务部署流程</h2> <ol><li>通过kubectl向apiserver发送命令在node上建立pod和container</li> <li>经过权限控制,调用资源,但还没有真正开始部署应用</li> <li>controller manager,scheduler,kubelet协助完成整个部署过程</li> <li>apiserver和controller manager,scheduler以及kubelet之间通过list-watch方式通信(事件发送与监听)</li> <li>controller manager通过etcd获取所需要创建的副本书,交由scheduler进行策略分析</li> <li>最后kubelet负责最终的pod创建,和容器的加载,部署号容器后通过service进行访问,通过cadvisor监控资源</li></ol> <h2 id="list-watch机制保持数据同步"><a href="#list-watch机制保持数据同步" class="header-anchor">#</a> list-watch机制保持数据同步</h2> <h2 id="crd-operator"><a href="#crd-operator" class="header-anchor">#</a> CRD Operator</h2> <h2 id="k8s-all-in-one-的yaml文件"><a href="#k8s-all-in-one-的yaml文件" class="header-anchor">#</a> k8s all in one 的yaml文件</h2> <h2 id="flutter构建mac-app"><a href="#flutter构建mac-app" class="header-anchor">#</a> flutter构建mac app</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>flutter config --enable-macos-desktop
</code></pre></div><h2 id="minikube代理"><a href="#minikube代理" class="header-anchor">#</a> minikube代理</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># ~/.minikube/machines/minikube/config.json` 修改 `HostOptions.EngineOptions.Env</span>
<span class="token string">&quot;Env&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;HTTP_PROXY=http://127.0.0.1:1087&quot;</span>,
      <span class="token string">&quot;HTTPS_PROXY=http://127.0.0.1:1087&quot;</span>,
<span class="token punctuation">]</span>,
<span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span>minikube docker-env<span class="token variable">)</span></span> <span class="token comment"># 使用minikube主机构建docker镜像</span>
<span class="token builtin class-name">eval</span> <span class="token variable"><span class="token variable">$(</span>minikube docker-env -u<span class="token variable">)</span></span> <span class="token comment"># 用本机构建docker镜像</span>
</code></pre></div><h2 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 创建deployment</span>
kubectl run hello-go --image<span class="token operator">=</span>hello-go:v1 --port<span class="token operator">=</span><span class="token number">8080</span> --image-pull-policy<span class="token operator">=</span>Never <span class="token comment"># 创建deployment --image-pull-policy nerver 永远使用本地镜像,而不是从docker hub拉取</span>
kubectl get deployments <span class="token comment"># 查看deployment</span>
kubectl get pods <span class="token comment"># 查看pod</span>
kubectl get events <span class="token comment"># 查看集群事件</span>
kubectl config view <span class="token comment"># 查看kubectl配置</span>
<span class="token comment"># 创建server,默认情况下pod只能集群内ip访问,要使外部可访问必须将pod公开为server</span>
kubectl expose deployment hello-go --type<span class="token operator">=</span>LoadBalancer <span class="token comment">#创建服务,将pod公开到公共网络 --type=LoadBalancer在支持负载均衡的云提供商上,将配置外部 IP 地址以访问服务.在 Minikube 上，LoadBalancer 类型通过 minikube service 命令使服务可访问。</span>
kubectl get svc <span class="token comment"># 查看server</span>
minikube <span class="token function">service</span> hello-go <span class="token comment"># 启动服务</span>
kubectl logs -f <span class="token operator">&lt;</span>pod-name<span class="token operator">&gt;</span> <span class="token comment"># 查看日志</span>
<span class="token comment"># 更新</span>
kubectl <span class="token builtin class-name">set</span> image deployment/hello-go hello-go<span class="token operator">=</span>hello-go:v2 <span class="token comment"># 更新镜像1</span>
kubectl edit deployment/hello-go <span class="token comment"># 更新镜像2,第二种方法</span>
<span class="token comment"># 插件</span>
minikube addons list <span class="token comment"># 查看插件</span>
minikube addons <span class="token builtin class-name">enable</span> heapster <span class="token comment"># 启用插件</span>
minikube addons <span class="token function">open</span> heapster
minikube addons disable heapster
kubectl get po,svc -n kube-system <span class="token comment"># 查看pod和ser</span>
kubectl delete <span class="token function">service</span> hello-go <span class="token comment"># 删除服务</span>
kubectl delete deployment hello-go <span class="token comment"># 删除部署</span>
kubectl logs -f pod-name
</code></pre></div><h2 id="istio"><a href="#istio" class="header-anchor">#</a> istio</h2> <div class="language-go extra-class"><pre class="language-go"><code>curl <span class="token operator">-</span>L https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>istio<span class="token punctuation">.</span>io<span class="token operator">/</span>downloadIstio <span class="token operator">|</span> sh <span class="token operator">-</span>
istioctl manifest apply <span class="token operator">--</span>set profile<span class="token operator">=</span>demo
kubectl get svc <span class="token operator">-</span>n istio<span class="token operator">-</span>system
kubectl get pods <span class="token operator">-</span>n istio<span class="token operator">-</span>system
</code></pre></div><h2 id="代理启动"><a href="#代理启动" class="header-anchor">#</a> 代理启动</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>minikube start  --registry-mirror<span class="token operator">=</span>http://hub-mirror.c.163.com --docker-env <span class="token assign-left variable">http_proxy</span><span class="token operator">=</span>http://127.0.0.1:1087 --docker-env <span class="token assign-left variable">https_proxy</span><span class="token operator">=</span>http://127.0.0.1:1087 -p <span class="token builtin class-name">test</span>
</code></pre></div><h2 id="复制控制器"><a href="#复制控制器" class="header-anchor">#</a> 复制控制器</h2> <p>主要目的是监控pod节点的数目,当我们启动pod的时候希望有多个pod副本,可以使用复制控制器来控制启动数目,如果期间部分pod挂了,复制控制器会自动进行重启.</p> <h2 id="命令速查"><a href="#命令速查" class="header-anchor">#</a> 命令速查</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">4/1/2020, 6:23:03 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/goistio.book/istio/最小镜像.html" class="prev">创建最小go镜像</a></span> <span class="next"><a href="/goistio.book/istio/简介.html">istio简介</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/goistio.book/assets/js/app.c80f4f4d.js" defer></script><script src="/goistio.book/assets/js/2.00693aab.js" defer></script><script src="/goistio.book/assets/js/13.e0915440.js" defer></script>
  </body>
</html>
